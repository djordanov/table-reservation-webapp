<app-header [role]="'Kunde'" [title]="'Reservierung anlegen'"></app-header>
<ng-container *ngIf="tables$ | async as tables">
<div *ngIf="isReservationRequestSend">
    <ng-container *ngIf="response$ | async as response">
        <app-reservation-create-response [reservation]="reservation" [response]="response"></app-reservation-create-response>
    </ng-container>
</div>
<div *ngIf="!isReservationRequestSend">
    <div class="row">
        <div class="col-md-7 ml-2">
            <app-tables [tableData]="tables?.table" (tableClicked)="onTableClicked($event)"></app-tables>
        </div>
        
        <div class="col-md-4 ml-2 mr-2" *ngIf="!isDateAndTimeSet">
            <h4> Wählen Sie zunächst Datum und Uhrzeit der Reservierung aus.</h4>
            <div class="row mt-3 col-md-9">
                <input type="date" class="form-control ml- form-control col-md-9" id="date" required="true" [(ngModel)] = "reservation.date" #date="ngModel">
                <div *ngIf="date.invalid && (date.dirty || date.touched)" class="alert alert-danger col-md-9">
                        Bitte geben Sie ein gültiges Datum ein!
                </div>
            </div>
            <div class="form-group row mt-3 col-md-9">
                <input type="time" class="form-control ml- form-control col-md-9" id="time" placeholder="von" required="true" [(ngModel)] = "reservation.time" #time="ngModel">
                <div *ngIf="time.invalid && (time.dirty || time.touched)" class="alert alert-danger col-md-9">
                        Bitte geben Sie eine gültige Zeit ein!
                </div>
                <label for="sel1" class="ml-2">Uhrzeit</label>
            </div>
            <button class="btn btn-primary btn-block container-fluid" (click)="setDateAndTime()">
                Bestätigen
            </button>
        </div>
        <div class="col-md-4" *ngIf="isDateAndTimeSet">
            <h4> Wählen Sie nun auf der linken Seite einen Tisch aus und tragen Sie weiter Daten ein.</h4>
            <div class = "row mt-4 mb-4" *ngIf="!isDateOnEdit">
                <h5 class="col-md-8">Reservierung für den {{reservation.date}} um {{reservation.time}}</h5>
                <button class="btn btn-outline-primary col-md-2" (click)="onDateEditClick()">Ändern</button>
            </div>
            <div class="row mt-4 mb-4" *ngIf="isDateOnEdit">
                <div class="col-md-9">
                    <div class="form-group row">
                        <input type="date" class="col-md-8 form-control ml-" id="editDate" [(ngModel)] = "reservationTime.date">
                        <label for="sel1" class="ml-2">Datum</label>
                    </div>
                    <div class="form-group row">
                        <input type="time" class="col-md-8 form-control ml-" id="editTime" [(ngModel)] = "reservationTime.time">
                        <label for="sel1" class="ml-2">Uhrzeit</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <button class="btn btn-outline-primary" (click)="backButtonClicked()">
                        Zurück
                    </button>
                    <button class="btn btn-outline-primary mt-3" (click)="setNewDateAndTime()">
                        Bestätigen
                    </button>
                </div>
            </div>
            <div class="form-group row justify-content-between">
                <input type="text" class="col-md-6  form-control" id="firstname" placeholder="Vorname" [(ngModel)] = "reservation.firstName" required="true" #firstname="ngModel">
                <input type="text" class="col-md-6  form-control" id="lastname" placeholder="Nachname" [(ngModel)] = "reservation.lastName" required="true" #lastname="ngModel">
                <div *ngIf="(firstname.invalid && (firstname.dirty || firstname.touched)) || (lastname.invalid && (lastname.dirty || lastname.touched))" class="alert alert-danger col-md-12">
                        Bitte geben Sie einen gültigen Vornamen oder Nachnamen ein!
                </div>
            </div>
            <div class="form-group row">
                <input type="text" class="col-md-12 form-control ml-" id="telephone" placeholder="Telefonnummer" [(ngModel)] = "reservation.telephoneNumber" required="true" #telephone="ngModel">
                <div *ngIf="telephone.invalid && (telephone.dirty || telephone.touched)" class="alert alert-danger col-md-12">
                        Bitte geben Sie eine gültige Telefonnummer ein!
                </div>
            </div>
            <div class="form-group row">
                <input type="email" class="col-md-12 form-control ml-" id="email" placeholder="E-Mail" [(ngModel)] = "reservation.email" required="true" #email="ngModel">
                <div *ngIf="email.invalid && (email.dirty || email.touched)" class="alert alert-danger col-md-12">
                        Bitte geben Sie eine gültige Email ein!
                </div>
            </div>
            <div class="form-group row">
                <select class="form-control col-md-2" id="sel1" [(ngModel)] = "reservation.numberOfPersons">
                    <option>1</option>
                    <option>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
                <label for="sel1" class="ml-2">Personen</label>
            </div>
            <div class="row">
                <button class="btn btn-primary btn-block" (click)="createReservation()">
                    Reservieren
                </button>
            </div>
        </div>
    </div>
</div>
</ng-container>